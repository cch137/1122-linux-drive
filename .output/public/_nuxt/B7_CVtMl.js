import{u as b,E}from"./B2P69qLK.js";import{b as $,c as z,_ as T,w as D,u as N,a as B,r as I,d as P}from"./C_VhRGin.js";import{f as w,u as V,g as R,i as U,o as u,h as q,w as i,r as O,n as j,j as s,k as A,l as H,m as C,q as K,c as g,a as c,b as l,d,s as M,F as W,v as X,t as Y}from"./BvF4o2qK.js";import{_ as G}from"./Bjq3F1oa.js";import{u as J,E as Q}from"./qCq1Xd3Y.js";import{a as Z}from"./25TpYJ86.js";import"./BqKQn9T9.js";const ee=$({type:{type:String,values:["primary","success","info","warning","danger",""],default:""},size:{type:String,values:z,default:""},truncated:{type:Boolean},lineClamp:{type:[String,Number]},tag:{type:String,default:"span"}}),te=w({name:"ElText"}),se=w({...te,props:ee,setup(a){const n=a,t=b(),e=V("text"),p=R(()=>[e.b(),e.m(n.type),e.m(t.value),e.is("truncated",n.truncated),e.is("line-clamp",!U(n.lineClamp))]);return(o,h)=>(u(),q(H(o.tag),{class:j(s(p)),style:A({"-webkit-line-clamp":o.lineClamp})},{default:i(()=>[O(o.$slots,"default")]),_:3},8,["class","style"]))}});var ae=T(se,[["__file","text.vue"]]);const ne=D(ae),f=C(!1),L=C([]);let x=!1;async function S(){if(x)return;x=!0;const a=new AbortController,n=new TextDecoder,t=async()=>{await p.read().then(async({value:o,done:h})=>{if(h){x=!1,S();return}n.decode(o)&&k(),t()})},p=(await fetch("/api/drive/event",{method:"POST",body:"{}",signal:a.signal})).body.getReader();t()}async function k(){try{const a=await $fetch("/api/drive/list",{method:"POST"});L.value=a.data,S()}catch{L.value=[]}}async function oe(){f.value=!0;try{await k()}catch{}f.value=!1}async function le(a){f.value=!0;try{const n=new FormData;if(a!==null)for(let e=0;e<a.length;e++)n.append(`${e}`,a[e]);const t=new XMLHttpRequest;t.open("POST","/api/drive/file"),t.send(n),t.upload.addEventListener("progress",e=>{console.log(e.lengthComputable,e.loaded,e.total)})}catch{}f.value=!1}async function ie(a){f.value=!0;try{await $fetch("/api/drive/file",{method:"DELETE",body:{fp:a}})}catch{}f.value=!1}function re(){return{fileList:L,isLoading:f,_refresh:k,refresh:oe,uploadFiles:le,deleteFile:ie}}const ce={class:"mt-8 flex-col flex-center"},de={key:0},ue={style:{display:"none"}},fe={class:"FileList mt-8"},pe={key:0},me={class:"text-center select-none"},_e={class:"FileItem flex justify-center items-center"},ge=["href"],he={key:1},ye=c("h1",null,"Welcome to Drive!",-1),ve={class:"mt-8 text-center"},Ee=w({__name:"index",setup(a){const{isLoggedIn:n}=N(),t=re(),{isLoading:e,fileList:p}=t;async function o(y,r="Loading..."){const m=Q.service({text:r});try{return await y()}finally{m.close()}}function h(){return document.querySelector(".FileUpload")}return K(n,y=>y?o(t.refresh):t.fileList.value=[]),n.value&&o(t.refresh),J(`${Z}`),(y,r)=>{const m=E,v=ne,F=G;return u(),g("div",ce,[s(n)?(u(),g("div",de,[c("div",null,[l(m,{icon:s(B),onClick:r[0]||(r[0]=_=>h().click()),loading:s(e)},{default:i(()=>[d("Upload")]),_:1},8,["icon","loading"]),l(m,{icon:s(I),onClick:r[1]||(r[1]=_=>o(s(t).refresh)),loading:s(e)},{default:i(()=>[d("Refresh")]),_:1},8,["icon","loading"]),c("form",ue,[c("input",{class:"FileUpload",type:"file",multiple:"",onChange:r[2]||(r[2]=_=>o(()=>s(t).uploadFiles(h().files)))},null,32)])]),c("div",fe,[s(p).length===0?(u(),g("div",pe,[c("div",me,[l(v,{type:"info"},{default:i(()=>[d("No files")]),_:1})])])):M("",!0),(u(!0),g(W,null,X(s(p),_=>(u(),g("div",_e,[c("a",{class:"flex-1",href:`/api/drive/file/${_}`,target:"_blank"},[l(v,{size:"large"},{default:i(()=>[d(Y(_),1)]),_:2},1024)],8,ge),l(m,{class:"FileItemDeleteBtn mx-1",icon:s(P),type:"danger",plain:"",loading:s(e),onClick:xe=>o(()=>s(t).deleteFile(_))},null,8,["icon","loading","onClick"])]))),256))])])):(u(),g("div",he,[ye,c("div",ve,[l(v,{size:"large"},{default:i(()=>[d("You are not logged in. ")]),_:1}),l(v,{size:"large"},{default:i(()=>[d("Please ")]),_:1}),l(F,{href:"/login"},{default:i(()=>[l(m,{size:"small",class:"HomepageLoginButton mb-1"},{default:i(()=>[d("Log In")]),_:1})]),_:1})])]))])}}});export{Ee as default};
